<!doctype html>
<html>
  <head>
    <title>BTC vs USD$</title>

    <meta name="viewport" content="width=device-width">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet" type="text/css">

    <style>
      /* MOBILE FIRST! */
      body {
        width: 95%;
        margin: 0 auto;
        font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        color: white;
        background: black;
      }

      h1 {
        color: yellow;
        font-size: 20pt;
        width: 100%;
        text-align: center;
      }

      h2 {
        font-size: 16pt;
        width: 100%;
        text-align: center;
      }

      ul#prices {
        margin: 0 auto;
        width: 80%;
        columns: 100px 2;
        -webkit-columns: 100px 2;
        -moz-columns: 100px 2;
      }

      ul#prices li {
        list-style-type: none;
      }

      span.price {
        color: aqua;
      }

      /* DESKTOP  / TABLET */
      @media (min-width:500px) {
        body {
          width: 80%;
          margin: 0 auto;
        }

        h1 {
          font-size: 40pt;
        }

        h2 {
          font-size: 32pt;
        }

        div#curr-price {
          font-size: 40pt;
        }

        ul#prices {
          columns: 100px 5;
          -webkit-columns: 100px 5;
          -moz-columns: 100px 5;
        }
      }      
    </style>
  </head>
  <body>
    <h1>BTC vs USD</h1>
    <h2 id="curr-price">
    </h2>
    <ul id="prices">
    </ul>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io.connect(window.location);
      socket.on('tick', function (data) {
        var $currPriceDiv = $('#curr-price');
        var $currPriceSpan = $currPriceDiv.find('span.price');
        var $pricesList = $('ul#prices');
        var prevPrice = parseFloat($currPriceSpan.text().substring(1)); // remove $
        var prevColor = $currPriceSpan.css('color');
        var currPrice = parseFloat(data.v);
        var priceTemplate = '<span class="price"></span>';
        var currColor = 'aqua';
        if (prevPrice) {
          if (currPrice > prevPrice) {
            currColor = 'green';
          } else if (currPrice < prevPrice) {
            currColor = 'red';
          }
        }

        // put the previous price into the price list, update the current price, and colorize / highlight as necessary
        if (prevPrice) {
          $pricesList.prepend('<li>' + priceTemplate + '</li>').find('li:first span.price').html('$' + prevPrice).css('color', prevColor);
        }
        $currPriceDiv.html(priceTemplate).find('span.price').html('$' + currPrice).css('color', currColor);
        if (currColor != 'aqua') { $currPriceDiv.find('span.price').effect("highlight", {}, 500); }

        // prune the list to 100 items (which works well for both 2 and 5 columns)
        $pricesList.find('li:gt(' + 99 + ')').remove();
      });
    </script>
  </body>
</html>
